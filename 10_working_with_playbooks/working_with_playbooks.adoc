:doctype: article
:reproducible:
:icons: font
:iconsdir: /etc/asciidoc/images/icons
:numbered:
:sectlinks:
:sectnums:
:toc: left
:toclevels: 3
:tabsize: 8
:numbered:
:source-highlighter: rouge
:experimental:

== Working with Playbooks

=== Intro to Playbooks

==== About Playbooks

==== Playbooks Language Example

==== Basics

==== Action Shorthand

==== Handlers: Running Operations On Change

==== Executing A Playbook

==== Ansible-Pull

==== Linting playbooks

==== Other playbook verification options

=== Creating Reusable Playbooks

==== Including and Importing

==== Roles

==== Dynamic vs. Static

==== Differences Between Dynamic and Static

==== Tradeoffs and Pitfalls Between Includes and Imports

=== Using Variables

==== Creating valid variable names

==== Defining variables in inventory

==== Defining variables in a playbook

==== Defining variables in included files and roles

==== Using variables with Jinja2

==== Transforming variables with Jinja2 filters

==== Hey wait, a YAML gotcha

==== Variables discovered from systems: Facts

==== Registering variables

==== Accessing complex variable data

==== Accessing information about other hosts with magic variables

==== Defining variables in files

==== Passing variables on the command line

==== Variable precedence: Where should I put a variable?

==== Using advanced variable syntax

=== Tamplating (Jinja2)

==== Filters

==== Tests

==== Lookups

==== Python Version and Templating

==== Get the current time

=== Conditionals

==== The When Statement

==== Loops and Conditionals

==== Loading in Custom Facts

==== Applying 'when' to roles, imports, and includes

==== Conditional Imports

==== Selecting Files And Templates Based On Variables

==== Register Variables

==== Commonly Used Facts

=== Loops

==== Comparing loop and with_*

==== Standard loops

==== Registering variables with a loop

==== Complex loops

==== Ensuring list input for loop: query vs. lookup

==== Adding controls to loops

==== Migrating from with_X to Loop

With the release of Ansible 2.5 and later, the recommended way to perform loops is the use the new `loop` keyword instead of `with_X` style loops.

Here, I am going to show how to convert `with_` style loops to `loop`.

*with_list*

`with_list` is directly replaced by `loop`

image::img/with_list-loop.png[]

REAL WORLD EXAMPLE:

The problem is: We have a openshift cluster environment running on vlan 10, we need to add more app-nodes to the cluster, but the networking team said that there is no more available IPs on vlan 10, so the networking team had created a vlan 20. Between the both vlans there is a Firewall. 

So, before add new app-nodes to the Openshift cluster we are going to create a Ansible playbook to solve this problem.

In this example we are going to have a bastion(ansible machine),two sources machines and one target machine.

. Create the hosts iventory file 
+
----
[root@bastion v3]# cat hosts.yml 
[masters]
host1.ansible-training.lab
host2.ansible-training.lab

[infras]

[new_nodes]
host3.ansible-training.lab

[ocs]

[all:children]
masters
infras
new_nodes
ocs

[source:children]
masters
infras
new_nodes
----


 



=== Blocks

==== Blocks error handling

=== Advanced Playbooks Features

==== Understanding privilege escalation: become

==== Asynchronous Actions and Polling

==== Check Mode ('Dry Run')

==== Playbook Debugger

==== Delegation, Rolling Updates, and Local Actions

==== Setting the Environment (and Working With Proxies)

==== Working With Language-Specific Version Managers

==== Error Handling In Playbooks

==== Advanced Syntax

==== Working With Plugins

==== Prompts

==== Tags

==== Using Vault in playbooks

==== Start and Step

==== Playbook keywords

==== Lookups

==== Module defaults

=== Controlling playbook execution: strategies and more

==== Selecting a strategy

==== Setting the number of forks

==== Using keywords to control execution


=== Best Practices

==== Content Organization

==== Staging vs Production

==== Rolling Updates

==== Always Mention The State

==== Group By Roles 

==== Operating System and Distribution Variance

==== Bundling Ansible Modules With Playbooks

==== Whitespace and Comments

==== Always Names Tasks

==== Keep It Simple

==== Version Control

==== Variable and Vaults

=== Playbook Example: Continuous Delivery and Rolling Upgrades

==== What is continuous Delivery?

==== Site deployment

==== Reusable content: roles

==== Configuration: group variables

==== The rolling upgrade

==== Managing other load balancers

==== Continuous delivery end-to-end
